@echo off
chcp 65001 >nul
color 0B
echo.
echo ???????????????????????????????????????????????????????????????????????????
echo    ?? COMPRIMIR VERSIÓN PORTABLE PARA TRANSFERENCIA
echo ???????????????????????????????????????????????????????????????????????????
echo.
echo Este script comprime la carpeta VersionPortable en un archivo ZIP
echo para facilitar su transferencia a la computadora de origen.
echo.
echo ???????????????????????????????????????????????????????????????????????????
echo.

set CARPETA=VersionPortable
set DESTINO=VersionPortable_Restaurante.zip

if not exist "%CARPETA%" (
    echo ? ERROR: No se encontró la carpeta VersionPortable
    echo.
    echo    Ejecuta primero la publicación del proyecto.
    echo.
    pause
    exit /b 1
)

echo ?? Información de la carpeta:
echo.
echo    Carpeta:  %CARPETA%
echo    Destino:  %DESTINO%
echo.

REM Contar archivos
for /f %%a in ('dir /b /s "%CARPETA%\*" ^| find /c /v ""') do set ARCHIVOS=%%a
echo    Archivos: %ARCHIVOS%
echo.

if exist "%DESTINO%" (
    echo ??  El archivo ZIP ya existe y será sobrescrito.
    echo.
)

echo ???????????????????????????????????????????????????????????????????????????
echo.
set /p CONFIRMAR="¿Desea continuar con la compresión? (S/N): "

if /i not "%CONFIRMAR%"=="S" (
    echo.
    echo ? Operación cancelada por el usuario.
    echo.
    pause
    exit /b 0
)

echo.
echo ?? Comprimiendo carpeta...
echo.
echo    Por favor espere, esto puede tardar unos momentos...
echo.

REM Eliminar ZIP anterior si existe
if exist "%DESTINO%" del /q "%DESTINO%"

REM Comprimir usando PowerShell
powershell -Command "Compress-Archive -Path '%CARPETA%\*' -DestinationPath '%DESTINO%' -CompressionLevel Optimal -Force"

if %ERRORLEVEL% EQU 0 (
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
    echo ??? COMPRESIÓN COMPLETADA EXITOSAMENTE ???
    echo ???????????????????????????????????????????????????????????????????????????
    echo.
    echo ?? Archivo ZIP generado:
    echo    %DESTINO%
    echo.
    
    for %%A in ("%DESTINO%") do (
        set TAMANO=%%~zA
        echo ?? Tamaño del archivo: %%~zA bytes
        echo    Aproximadamente: 
        set /a MEGAS=%%~zA/1048576
        echo    !MEGAS! MB
    )
    
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
    echo ?? SIGUIENTE PASO:
    echo ???????????????????????????????????????????????????????????????????????????
    echo.
    echo 1. Copia el archivo "%DESTINO%" a una USB
    echo.
    echo 2. Llévalo a la computadora de origen
    echo.
    echo 3. Extrae el contenido del ZIP:
    echo    - Click derecho ? Extraer todo...
    echo    - O usa WinRAR/7-Zip
    echo.
    echo 4. Ejecuta restaurante.exe desde la carpeta extraída
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
    echo ?? IMPORTANTE:
    echo ???????????????????????????????????????????????????????????????????????????
    echo.
    echo • El ZIP contiene TODOS los archivos necesarios (308 archivos)
    echo.
    echo • Incluye la base de datos con todos los platillos
    echo.
    echo • NO requiere instalación en la computadora de destino
    echo.
    echo • Compatible con Windows 7 SP1 o superior (64 bits)
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
    echo.
    
    REM Preguntar si quiere abrir la ubicación
    set /p ABRIR="¿Desea abrir la ubicación del archivo ZIP? (S/N): "
    
    if /i "%ABRIR%"=="S" (
        explorer /select,"%DESTINO%"
    )
    
) else (
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
    echo ? ERROR AL COMPRIMIR
    echo ???????????????????????????????????????????????????????????????????????????
    echo.
    echo Posibles causas:
    echo   • Falta espacio en disco
    echo   • Permisos insuficientes
    echo   • Archivos en uso
    echo.
    echo Intenta:
    echo   1. Cerrar la aplicación si está abierta
    echo   2. Ejecutar como administrador
    echo   3. Verificar espacio en disco
    echo.
)

echo.
pause
