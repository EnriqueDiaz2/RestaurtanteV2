@echo off
chcp 65001 >nul
color 0A
echo.
echo ???????????????????????????????????????????????????????????????????????????
echo    ?? RESPALDAR BASE DE DATOS ACTUALIZADA
echo ???????????????????????????????????????????????????????????????????????????
echo.
echo Este script respalda la base de datos desde bin\Debug a la raíz del proyecto
echo.
echo ???????????????????????????????????????????????????????????????????????????
echo.

set ORIGEN=restaurante\bin\Debug\net6.0-windows\restaurante.db
set DESTINO=restaurante\restaurante.db

if not exist "%ORIGEN%" (
    echo ? ERROR: No se encontró la base de datos en:
    echo    %ORIGEN%
    echo.
    echo    Ejecuta la aplicación primero para generar la base de datos.
    echo.
    pause
    exit /b 1
)

echo ?? Información de la base de datos actual:
echo.
echo    Origen:  %ORIGEN%
for %%A in ("%ORIGEN%") do (
    echo    Tamaño:  %%~zA bytes
    echo    Fecha:   %%~tA
)
echo.

if exist "%DESTINO%" (
    echo ?? Base de datos de respaldo existente:
    echo.
    echo    Destino: %DESTINO%
    for %%A in ("%DESTINO%") do (
        echo    Tamaño:  %%~zA bytes
        echo    Fecha:   %%~tA
    )
    echo.
    echo ??  El archivo de respaldo será sobrescrito.
    echo.
)

echo ???????????????????????????????????????????????????????????????????????????
echo.
set /p CONFIRMAR="¿Desea continuar con el respaldo? (S/N): "

if /i not "%CONFIRMAR%"=="S" (
    echo.
    echo ? Operación cancelada por el usuario.
    echo.
    pause
    exit /b 0
)

echo.
echo ?? Realizando respaldo...
echo.

copy /Y "%ORIGEN%" "%DESTINO%"

if %ERRORLEVEL% EQU 0 (
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
    echo ??? RESPALDO COMPLETADO EXITOSAMENTE ???
    echo ???????????????????????????????????????????????????????????????????????????
    echo.
    echo ?? La base de datos ha sido respaldada en:
    echo    %DESTINO%
    echo.
    
    for %%A in ("%DESTINO%") do (
        echo ?? Tamaño del respaldo: %%~zA bytes
        echo ?? Fecha: %%~tA
    )
    
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
    echo ?? RECOMENDACIONES:
    echo ???????????????????????????????????????????????????????????????????????????
    echo.
    echo 1. Este archivo se copiará automáticamente a bin\Debug cuando ejecutes
    echo    la aplicación si no existe allí.
    echo.
    echo 2. Haz respaldos adicionales en otra ubicación segura regularmente.
    echo.
    echo 3. Considera usar un servicio en la nube (Google Drive, OneDrive, etc.)
    echo    para respaldos externos.
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
) else (
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
    echo ? ERROR AL REALIZAR EL RESPALDO
    echo ???????????????????????????????????????????????????????????????????????????
    echo.
    echo Posibles causas:
    echo   • El archivo está en uso (cierra la aplicación)
    echo   • Permisos insuficientes (ejecuta como administrador)
    echo   • Falta espacio en disco
    echo.
)

echo.
pause
