@echo off
chcp 65001 >nul
echo ???????????????????????????????????????????????????????????????????????????
echo    CREAR ZIP DE VERSIÓN PORTABLE
echo ???????????????????????????????????????????????????????????????????????????
echo.

REM Verificar si existe la carpeta portable
if not exist "publish\portable" (
    echo ? ERROR: No existe la carpeta publish\portable
    echo.
    echo Primero debe generar la versión portable ejecutando:
    echo    dotnet publish restaurante\restaurante.csproj -c Release -r win-x64 --self-contained true -p:PublishSingleFile=false -o publish\portable
    echo.
    pause
    exit /b 1
)

REM Obtener la fecha actual para el nombre del archivo
for /f "tokens=2 delims==" %%I in ('wmic os get localdatetime /value') do set datetime=%%I
set FECHA=%datetime:~0,4%-%datetime:~4,2%-%datetime:~6,2%

REM Definir nombre del archivo ZIP
set NOMBRE_ZIP=Restaurante_Portable_%FECHA%.zip

echo ?? Creando archivo ZIP...
echo.
echo ?? Carpeta origen: publish\portable\
echo ?? Archivo destino: %NOMBRE_ZIP%
echo.

REM Eliminar ZIP anterior si existe
if exist "%NOMBRE_ZIP%" (
    echo ???  Eliminando ZIP anterior...
    del "%NOMBRE_ZIP%"
)

REM Crear el archivo ZIP usando PowerShell
powershell -NoProfile -Command "Compress-Archive -Path 'publish\portable\*' -DestinationPath '%NOMBRE_ZIP%' -CompressionLevel Optimal"

if %ERRORLEVEL% EQU 0 (
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
    echo ? ARCHIVO ZIP CREADO EXITOSAMENTE
    echo ???????????????????????????????????????????????????????????????????????????
    echo.
    echo ?? Archivo: %NOMBRE_ZIP%
    
    REM Obtener tamaño del archivo
    for %%A in ("%NOMBRE_ZIP%") do set TAMANIO=%%~zA
    set /a TAMANIO_MB=%TAMANIO% / 1048576
    echo ?? Tamaño: %TAMANIO_MB% MB
    echo.
    echo ?? Ubicación: %CD%\%NOMBRE_ZIP%
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
    echo.
    echo Ya puede distribuir el archivo ZIP.
    echo Los usuarios solo deben descomprimirlo y ejecutar "restaurante.exe"
    echo.
) else (
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
    echo ? ERROR AL CREAR EL ARCHIVO ZIP
    echo ???????????????????????????????????????????????????????????????????????????
    echo.
    echo Verifique que:
    echo   • PowerShell esté disponible
    echo   • Tenga permisos de escritura en esta carpeta
    echo   • No haya otro programa usando los archivos
    echo.
)

pause
