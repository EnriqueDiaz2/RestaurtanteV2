@echo off
chcp 65001 >nul
color 0C
echo.
echo ???????????????????????????????????????????????????????????????????????????
echo    ?? RESTAURAR BASE DE DATOS DESDE RESPALDO
echo ???????????????????????????????????????????????????????????????????????????
echo.
echo Este script restaura la base de datos desde la raíz del proyecto a bin\Debug
echo.
echo ??  ADVERTENCIA: Esto sobrescribirá la base de datos actual en bin\Debug
echo.
echo ???????????????????????????????????????????????????????????????????????????
echo.

set ORIGEN=restaurante\restaurante.db
set DESTINO=restaurante\bin\Debug\net6.0-windows\restaurante.db

if not exist "%ORIGEN%" (
    echo ? ERROR: No se encontró la base de datos de respaldo en:
    echo    %ORIGEN%
    echo.
    echo    Verifica que el archivo de respaldo exista.
    echo.
    pause
    exit /b 1
)

echo ?? Información de la base de datos de respaldo:
echo.
echo    Origen:  %ORIGEN%
for %%A in ("%ORIGEN%") do (
    echo    Tamaño:  %%~zA bytes
    echo    Fecha:   %%~tA
)
echo.

if exist "%DESTINO%" (
    echo ?? Base de datos actual en bin\Debug (será sobrescrita):
    echo.
    echo    Destino: %DESTINO%
    for %%A in ("%DESTINO%") do (
        echo    Tamaño:  %%~zA bytes
        echo    Fecha:   %%~tA
    )
    echo.
)

echo ???????????????????????????????????????????????????????????????????????????
echo.
set /p CONFIRMAR="¿Desea continuar con la restauración? (S/N): "

if /i not "%CONFIRMAR%"=="S" (
    echo.
    echo ? Operación cancelada por el usuario.
    echo.
    pause
    exit /b 0
)

echo.
echo ?? Restaurando base de datos...
echo.

REM Crear directorio si no existe
if not exist "restaurante\bin\Debug\net6.0-windows" (
    mkdir "restaurante\bin\Debug\net6.0-windows"
)

copy /Y "%ORIGEN%" "%DESTINO%"

if %ERRORLEVEL% EQU 0 (
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
    echo ??? RESTAURACIÓN COMPLETADA EXITOSAMENTE ???
    echo ???????????????????????????????????????????????????????????????????????????
    echo.
    echo ?? La base de datos ha sido restaurada en:
    echo    %DESTINO%
    echo.
    
    for %%A in ("%DESTINO%") do (
        echo ?? Tamaño: %%~zA bytes
        echo ?? Fecha: %%~tA
    )
    
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
    echo ?? SIGUIENTE PASO:
    echo ???????????????????????????????????????????????????????????????????????????
    echo.
    echo Ya puedes ejecutar la aplicación y debería cargar los datos restaurados.
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
) else (
    echo.
    echo ???????????????????????????????????????????????????????????????????????????
    echo ? ERROR AL RESTAURAR LA BASE DE DATOS
    echo ???????????????????????????????????????????????????????????????????????????
    echo.
    echo Posibles causas:
    echo   • El archivo está en uso (cierra la aplicación)
    echo   • Permisos insuficientes (ejecuta como administrador)
    echo   • El directorio de destino no existe
    echo.
)

echo.
pause
